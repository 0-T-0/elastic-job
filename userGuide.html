<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Elastic-job by dangdangdotcom</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Elastic-job</h1>
      <h2 class="project-tagline">Elastic-Job is a distributed scheduled job framework, based on Quartz and Curator.</h2>
      <a href="https://github.com/dangdangdotcom/elastic-job" class="btn">View on GitHub</a>
      <a href="https://github.com/dangdangdotcom/elastic-job/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/dangdangdotcom/elastic-job/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
<h1>开发指南</h1>
<h2>
<a id="代码开发" class="anchor" href="#%E4%BB%A3%E7%A0%81%E5%BC%80%E5%8F%91" aria-hidden="true"><span class="octicon octicon-link"></span></a>代码开发</h2>

<p>提供3种作业类型，分别是OneOff, Perpetual和SequencePerpetual。需要继承相应的抽象类。</p>

<p>方法参数shardingContext包含作业配置，分片和运行时信息。可通过getShardingTotalCount(),getShardingItems()等方法分别获取分片总数，运行在本作业服务器的分片序列号集合等。</p>

<ul>
<li>
<p><strong>OneOff类型作业</strong></p>

<p>OneOff作业类型比较简单，需要继承AbstractOneOffElasticJob，该类只提供了一个方法用于覆盖，此方法将被定时执行。用于执行普通的定时任务，与Quartz原生接口相似，只是增加了弹性扩缩容和分片等功能。</p>
</li>
</ul>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MyElasticJob</span> <span class="pl-k">extends</span> <span class="pl-e">AbstractOneOffElasticJob</span> {

    <span class="pl-k">@Override</span>
    <span class="pl-k">protected</span> <span class="pl-k">void</span> <span class="pl-en">process</span>(<span class="pl-smi">JobExecutionMultipleShardingContext</span> <span class="pl-v">context</span>) {
        <span class="pl-c">// do something by sharding items</span>
    }
}</pre></div>

<ul>
<li>
<p><strong>Perpetual类型作业</strong></p>

<p>Perpetual作业类型略为复杂，需要继承AbstractPerpetualElasticJob并可以指定返回值泛型，该类提供两个方法可覆盖，分别用于抓取和处理数据。可以获取数据处理成功失败次数等辅助监控信息。<strong>需要注意fetchData方法的返回值只有为null或长度为空时，作业才会停止执行，否则作业会一直运行下去。</strong>这点是参照TbSchedule的设计。Perpetual作业类型更适用于流式不间歇的数据处理。</p>

<p>作业执行时会将fetchData的数据传递给processData处理，其中processData得到的数据是通过多线程（线程池大小可配）拆分的。建议processData处理数据后，更新其状态，避免fetchData再次抓取到，从而使得作业永远不会停止。processData的返回值用于表示数据是否处理成功，抛出异常或者返回false将会在统计信息中归入失败次数，返回true则归入成功次数。</p>
</li>
</ul>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MyElasticJob</span> <span class="pl-k">extends</span> <span class="pl-e">AbstractPerpetualElasticJob&lt;<span class="pl-smi">Foo</span>&gt;</span> {

    <span class="pl-k">@Override</span>
    <span class="pl-k">protected</span> <span class="pl-k">List&lt;<span class="pl-smi">Foo</span>&gt;</span> <span class="pl-en">fetchData</span>(<span class="pl-smi">JobExecutionMultipleShardingContext</span> <span class="pl-v">context</span>) {
        <span class="pl-k">Map&lt;<span class="pl-smi">Integer</span>, <span class="pl-smi">String</span>&gt;</span> offset <span class="pl-k">=</span> context<span class="pl-k">.</span>getOffsets();
        <span class="pl-k">List&lt;<span class="pl-smi">Foo</span>&gt;</span> result <span class="pl-k">=</span> <span class="pl-c">// get data from database by sharding items and by offset</span>
        <span class="pl-k">return</span> result;
    }

    <span class="pl-k">@Override</span>
    <span class="pl-k">protected</span> <span class="pl-k">boolean</span> <span class="pl-en">processData</span>(<span class="pl-smi">JobExecutionMultipleShardingContext</span> <span class="pl-v">context</span>, <span class="pl-smi">Foo</span> <span class="pl-v">data</span>) {
        <span class="pl-c">// process data</span>
        <span class="pl-c">// ...</span>

        <span class="pl-c">// store offset</span>
        <span class="pl-k">for</span> (<span class="pl-k">int</span> each <span class="pl-k">:</span> context<span class="pl-k">.</span>getShardingItems()) {
            updateOffset(each, <span class="pl-s"><span class="pl-pds">"</span>your offset, maybe id<span class="pl-pds">"</span></span>);
        }
        <span class="pl-k">return</span> <span class="pl-c1">true</span>;
    }
}</pre></div>

<ul>
<li>
<p><strong>SequencePerpetual类型作业</strong></p>

<p>SequencePerpetual作业类型和Perpetual作业类型极为相似，所不同的是Perpetual作业类型可以将获取到的数据多线程处理，但不会保证多线程处理数据的顺序。如：从2个分片共获取到100条数据，第1个分片40条，第2个分片60条，配置为两个线程处理，则第1个线程处理前50条数据，第2个线程处理后50条数据，无视分片项；SequencePerpetual类型作业则根据当前服务器所分配的分片项数量进行多线程处理，每个分片项使用同一线程处理，防止了同一分片的数据被多线程处理，从而导致的顺序问题。如：从2个分片共获取到100条数据，第1个分片40条，第2个分片60条，则系统自动分配两个线程处理，第1个线程处理第1个分片的40条数据，第2个线程处理第2个分片的60条数据。由于Perpetual作业可以使用多余分片项的任意线程数处理，所以性能调优的可能会优于SequencePerpetual作业。</p>
</li>
</ul>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MyElasticJob</span> <span class="pl-k">extends</span> <span class="pl-e">AbstractSequencePerpetualElasticJob&lt;<span class="pl-smi">Foo</span>&gt;</span> {

    <span class="pl-k">@Override</span>
    <span class="pl-k">protected</span> <span class="pl-k">List&lt;<span class="pl-smi">Foo</span>&gt;</span> <span class="pl-en">fetchData</span>(<span class="pl-smi">JobExecutionSingleShardingContext</span> <span class="pl-v">context</span>) {
        <span class="pl-k">int</span> offset <span class="pl-k">=</span> context<span class="pl-k">.</span>getOffset();
        <span class="pl-k">List&lt;<span class="pl-smi">Foo</span>&gt;</span> result <span class="pl-k">=</span> <span class="pl-c">// get data from database by sharding items and by offset</span>
        <span class="pl-k">return</span> result;
    }

    <span class="pl-k">@Override</span>
    <span class="pl-k">protected</span> <span class="pl-k">boolean</span> <span class="pl-en">processData</span>(<span class="pl-smi">JobExecutionSingleShardingContext</span> <span class="pl-v">context</span>, <span class="pl-smi">Foo</span> <span class="pl-v">data</span>) {
        <span class="pl-c">// process data</span>
        <span class="pl-c">// ...</span>

        <span class="pl-c">// store offset</span>
        updateOffset(context<span class="pl-k">.</span>getShardingItem(), <span class="pl-s"><span class="pl-pds">"</span>your offset, maybe id<span class="pl-pds">"</span></span>);
        <span class="pl-k">return</span> <span class="pl-c1">true</span>;
    }
}</pre></div>

<h2>
<a id="作业配置" class="anchor" href="#%E4%BD%9C%E4%B8%9A%E9%85%8D%E7%BD%AE" aria-hidden="true"><span class="octicon octicon-link"></span></a>作业配置</h2>

<p>与Spring容器配合使用作业，可以将作业Bean配置为Spring Bean，可在作业中通过依赖注入使用Spring容器管理的数据源等对象。可用placeholder占位符从属性文件中取值。</p>

<ul>
<li><strong>Spring命名空间配置</strong></li>
</ul>

<div class="highlight highlight-text-xml"><pre>&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span><span class="pl-e"> encoding</span>=<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>?&gt;
&lt;<span class="pl-ent">beans</span> <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.springframework.org/schema/beans<span class="pl-pds">"</span></span>
    <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">xsi</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="pl-pds">"</span></span>
    <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">reg</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.dangdang.com/schema/ddframe/reg<span class="pl-pds">"</span></span> 
    <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">job</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.dangdang.com/schema/ddframe/job<span class="pl-pds">"</span></span> 
    <span class="pl-e">xsi</span><span class="pl-e">:</span><span class="pl-e">schemaLocation</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.springframework.org/schema/beans </span>
<span class="pl-s">                        http://www.springframework.org/schema/beans/spring-beans.xsd </span>
<span class="pl-s">                        http://www.dangdang.com/schema/ddframe/reg </span>
<span class="pl-s">                        http://www.dangdang.com/schema/ddframe/reg/reg.xsd </span>
<span class="pl-s">                        http://www.dangdang.com/schema/ddframe/job </span>
<span class="pl-s">                        http://www.dangdang.com/schema/ddframe/job/job.xsd </span>
<span class="pl-s">                        <span class="pl-pds">"</span></span>&gt;
    <span class="pl-c">&lt;!--配置作业注册中心 --&gt;</span>
    &lt;<span class="pl-ent">reg</span><span class="pl-ent">:</span><span class="pl-ent">zookeeper</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>regCenter<span class="pl-pds">"</span></span> <span class="pl-e">serverLists</span>=<span class="pl-s"><span class="pl-pds">"</span> yourhost:2181<span class="pl-pds">"</span></span> <span class="pl-e">namespace</span>=<span class="pl-s"><span class="pl-pds">"</span>dd-job<span class="pl-pds">"</span></span> <span class="pl-e">baseSleepTimeMilliseconds</span>=<span class="pl-s"><span class="pl-pds">"</span>1000<span class="pl-pds">"</span></span> <span class="pl-e">maxSleepTimeMilliseconds</span>=<span class="pl-s"><span class="pl-pds">"</span>3000<span class="pl-pds">"</span></span> <span class="pl-e">maxRetries</span>=<span class="pl-s"><span class="pl-pds">"</span>3<span class="pl-pds">"</span></span> /&gt;

    <span class="pl-c">&lt;!-- 配置作业A--&gt;</span>
    &lt;<span class="pl-ent">job</span><span class="pl-ent">:</span><span class="pl-ent">bean</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>oneOffElasticJob<span class="pl-pds">"</span></span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>xxx.MyOneOffElasticJob<span class="pl-pds">"</span></span> <span class="pl-e">regCenter</span>=<span class="pl-s"><span class="pl-pds">"</span>regCenter<span class="pl-pds">"</span></span> <span class="pl-e">cron</span>=<span class="pl-s"><span class="pl-pds">"</span>0/10 * * * * ?<span class="pl-pds">"</span></span>   <span class="pl-e">shardingTotalCount</span>=<span class="pl-s"><span class="pl-pds">"</span>3<span class="pl-pds">"</span></span> <span class="pl-e">shardingItemParameters</span>=<span class="pl-s"><span class="pl-pds">"</span>0=A,1=B,2=C<span class="pl-pds">"</span></span> /&gt;

    <span class="pl-c">&lt;!-- 配置作业B--&gt;</span>
    &lt;<span class="pl-ent">job</span><span class="pl-ent">:</span><span class="pl-ent">bean</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>perpetualElasticJob<span class="pl-pds">"</span></span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>xxx.MyPerpetualElasticJob<span class="pl-pds">"</span></span> <span class="pl-e">regCenter</span>=<span class="pl-s"><span class="pl-pds">"</span>regCenter<span class="pl-pds">"</span></span> <span class="pl-e">cron</span>=<span class="pl-s"><span class="pl-pds">"</span>0/10 * * * * ?<span class="pl-pds">"</span></span> <span class="pl-e">shardingTotalCount</span>=<span class="pl-s"><span class="pl-pds">"</span>3<span class="pl-pds">"</span></span> <span class="pl-e">shardingItemParameters</span>=<span class="pl-s"><span class="pl-pds">"</span>0=A,1=B,2=C<span class="pl-pds">"</span></span> <span class="pl-e">processCountIntervalSeconds</span>=<span class="pl-s"><span class="pl-pds">"</span>10<span class="pl-pds">"</span></span> <span class="pl-e">concurrentDataProcessThreadCount</span>=<span class="pl-s"><span class="pl-pds">"</span>10<span class="pl-pds">"</span></span> /&gt;
&lt;/<span class="pl-ent">beans</span>&gt;</pre></div>

<p><strong>job:bean命名空间属性详细说明</strong></p>

<table>
<tbody>
<tr>
<td><em>属性名</em></td>
<td><em>类型</em></td>
<td><em>是否必填</em></td>
<td><em>缺省值</em></td>
<td><em>描述</em></td>
</tr>
<tr>
<td>id</td>
<td>String</td>
<td>是</td>
<td></td>
<td>作业名称</td>
</tr>
<tr>
<td>class</td>
<td>String</td>
<td>是</td>
<td></td>
<td>作业实现类，需实现ElasticJob接口</td>
</tr>
<tr>
<td>regCenter</td>
<td>String</td>
<td>是</td>
<td></td>
<td>注册中心Bean的引用，需引用reg:zookeeper的声明</td>
</tr>
<tr>
<td>cron</td>
<td>String</td>
<td>是</td>
<td></td>
<td>cron表达式，用于配置作业触发时间</td>
</tr>
<tr>
<td>shardingTotalCount</td>
<td>int</td>
<td>是</td>
<td></td>
<td>作业分片总数</td>
</tr>
<tr>
<td>shardingItemParameters</td>
<td>String</td>
<td>否</td>
<td></td>
<td>分片序列号和个性化参数对照表<br>分片序列号和参数用等号分隔，多个键值对用逗号分隔<br>分片序列号从0开始，不可大于或等于作业分片总数<br>如：<br>0=a,1=b,2=c</td>
</tr>
<tr>
<td>jobParameter</td>
<td>String</td>
<td>否</td>
<td></td>
<td>作业自定义参数<br>可以配置多个相同的作业，但是用不同的参数作为不同的调度实例</td>
</tr>
<tr>
<td>monitorRuntime</td>
<td>boolean</td>
<td>否</td>
<td>true</td>
<td>监控作业运行时状态<br>每次作业执行时间和间隔时间均非常短的情况，建议不监控作业运行时状态以提升效率。因为是瞬时状态，所以无必要监控。请用户自行增加数据堆积监控。并且不能保证数据重复选取，应在作业中实现幂等性。<br>每次作业执行时间和间隔时间均较长短的情况，建议监控作业运行时状态，可保证数据不会重复选取。
</td>
</tr>
<tr>
<td>processCountIntervalSeconds</td>
<td>int</td>
<td>否</td>
<td>300</td>
<td>统计作业处理数据数量的间隔时间<br>单位：秒<br>对Perpetual和SequencePerpetual作业有效</td>
</tr>
<tr>
<td>concurrentDataProcessThreadCount</td>
<td>int</td>
<td>否</td>
<td>1</td>
<td>同时处理数据的并发线程数<br>不能小于1<br>仅Perpetual作业有效</td>
</tr>
<tr>
<td>fetchDataCount</td>
<td>int</td>
<td>否</td>
<td>0</td>
<td>每次抓取的数据量</td>
</tr>
<tr>
<td>failover</td>
<td>boolean</td>
<td>否</td>
<td>false</td>
<td>是否开启失效转移<br>仅monitorExecution开启，失效转移才有效</td>
</tr>
<tr>
<td>description</td>
<td>String</td>
<td>否</td>
<td></td>
<td>作业描述信息</td>
</tr>
<tr>
<td>disabled</td>
<td>boolean</td>
<td>否</td>
<td>false</td>
<td>作业是否禁止启动<br>可用于部署作业时，先禁止启动，部署结束后统一启动</td>
</tr>
<tr>
<td>overwrite</td>
<td>boolean</td>
<td>否</td>
<td>false</td>
<td>本地配置是否可覆盖注册中心配置<br>如果可覆盖，每次启动作业都以本地配置为准</td>
</tr>
</tbody>
</table>

<p><strong>reg:zookeeper命名空间属性详细说明</strong></p>

<table>
<tbody>
<tr>
<td><em>属性名</em></td>
<td><em>类型</em></td>
<td><em>是否必填</em></td>
<td><em>缺省值</em></td>
<td><em>描述</em></td>
</tr>
<tr>
<td>id</td>
<td>String</td>
<td>是</td>
<td></td>
<td>注册中心在Spring容器中的主键</td>
</tr>
<tr>
<td>serverLists</td>
<td>String</td>
<td>是</td>
<td></td>
<td>连接Zookeeper服务器的列表<br>包括IP地址和端口号<br>多个地址用逗号分隔<br>如: host1:2181,host2:2181</td>
</tr>
<tr>
<td>namespace</td>
<td>String</td>
<td>是</td>
<td></td>
<td>Zookeeper的命名空间</td>
</tr>
<tr>
<td>baseSleepTimeMilliseconds</td>
<td>int</td>
<td>是</td>
<td></td>
<td>等待重试的间隔时间的初始值<br>单位：毫秒</td>
</tr>
<tr>
<td>maxSleepTimeMilliseconds</td>
<td>int</td>
<td>是</td>
<td></td>
<td>等待重试的间隔时间的最大值<br>单位：毫秒</td>
</tr>
<tr>
<td>maxRetries</td>
<td>int</td>
<td>是</td>
<td></td>
<td>最大重试次数</td>
</tr>
<tr>
<td>sessionTimeoutMilliseconds</td>
<td>int</td>
<td>否</td>
<td>60000</td>
<td>会话超时时间<br>单位：毫秒</td>
</tr>
<tr>
<td>connectionTimeoutMilliseconds</td>
<td>int</td>
<td>否</td>
<td>15000</td>
<td>连接超时时间<br>单位：毫秒</td>
</tr>
<tr>
<td>digest</td>
<td>String</td>
<td>否</td>
<td>无权限验证</td>
<td>连接Zookeeper的权限令牌<br>缺省为不需要权限验证</td>
</tr>
</tbody>
</table>

<ul>
<li><strong>基于Spring但不使用命名空间</strong></li>
</ul>

<div class="highlight highlight-text-xml"><pre>    <span class="pl-c">&lt;!-- 配置作业注册中心 --&gt;</span>
    &lt;<span class="pl-ent">bean</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>regCenter<span class="pl-pds">"</span></span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>com.dangdang.ddframe.reg.zookeeper.ZookeeperRegistryCenter<span class="pl-pds">"</span></span> <span class="pl-e">init-method</span>=<span class="pl-s"><span class="pl-pds">"</span>init<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">constructor-arg</span>&gt;
            &lt;<span class="pl-ent">bean</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>com.dangdang.ddframe.reg.zookeeper.ZookeeperConfiguration<span class="pl-pds">"</span></span>&gt;
                &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>serverLists<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>${xxx}<span class="pl-pds">"</span></span> /&gt;
                &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>namespace<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>${xxx}<span class="pl-pds">"</span></span> /&gt;
                &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>baseSleepTimeMilliseconds<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>${xxx}<span class="pl-pds">"</span></span> /&gt;
                &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>maxSleepTimeMilliseconds<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>${xxx}<span class="pl-pds">"</span></span> /&gt;
                &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>maxRetries<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>${xxx}<span class="pl-pds">"</span></span> /&gt;
            &lt;/<span class="pl-ent">bean</span>&gt;
        &lt;/<span class="pl-ent">constructor-arg</span>&gt;
    &lt;/<span class="pl-ent">bean</span>&gt;
    <span class="pl-c">&lt;!-- 配置作业--&gt;</span>
    &lt;<span class="pl-ent">bean</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>xxxJob<span class="pl-pds">"</span></span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>com.dangdang.ddframe.job.spring.schedule.SpringJobController<span class="pl-pds">"</span></span> <span class="pl-e">init-method</span>=<span class="pl-s"><span class="pl-pds">"</span>init<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">constructor-arg</span> <span class="pl-e">ref</span>=<span class="pl-s"><span class="pl-pds">"</span>regCenter<span class="pl-pds">"</span></span> /&gt;
        &lt;<span class="pl-ent">constructor-arg</span>&gt;
            &lt;<span class="pl-ent">bean</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>com.dangdang.ddframe.job.api.JobConfiguration<span class="pl-pds">"</span></span>&gt;
                &lt;<span class="pl-ent">constructor-arg</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>jobName<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>xxxJob<span class="pl-pds">"</span></span> /&gt;
                &lt;<span class="pl-ent">constructor-arg</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>jobClass<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>xxxDemoJob<span class="pl-pds">"</span></span> /&gt;
                &lt;<span class="pl-ent">constructor-arg</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>shardingTotalCount<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>10<span class="pl-pds">"</span></span> /&gt;
                &lt;<span class="pl-ent">constructor-arg</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>cron<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>0/10 * * * * ?<span class="pl-pds">"</span></span> /&gt;
                &lt;<span class="pl-ent">property</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>shardingItemParameters<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>${xxx}<span class="pl-pds">"</span></span> /&gt;
            &lt;/<span class="pl-ent">bean</span>&gt;
        &lt;/<span class="pl-ent">constructor-arg</span>&gt;
    &lt;/<span class="pl-ent">bean</span>&gt;</pre></div>

<ul>
<li><strong>不使用Spring配置</strong></li>
</ul>

<p>如果不使用Spring框架，可以用如下方式启动作业。</p>
<pre class="rich-diff-level-zero"><span class="pl-k rich-diff-level-one">import</span> <span class="pl-smi rich-diff-level-one">com.dangdang.ddframe.job.api.JobConfiguration</span>;
<span class="pl-k rich-diff-level-one">import</span> <span class="pl-smi rich-diff-level-one">com.dangdang.ddframe.job.schedule.JobController</span>;
<span class="pl-k rich-diff-level-one">import</span> <span class="pl-smi rich-diff-level-one">com.dangdang.ddframe.reg.base.CoordinatorRegistryCenter</span>;
<span class="pl-k rich-diff-level-one">import</span> <span class="pl-smi rich-diff-level-one">com.dangdang.ddframe.reg.zookeeper.ZookeeperConfiguration</span>;
<span class="pl-k rich-diff-level-one">import</span> <span class="pl-smi rich-diff-level-one">com.dangdang.ddframe.reg.zookeeper.ZookeeperRegistryCenter</span>;
<span class="pl-k rich-diff-level-one">import</span> <span class="pl-smi rich-diff-level-one">com.dangdang.example.elasticjob.core.job.OneOffElasticDemoJob</span>;
<span class="pl-k rich-diff-level-one">import</span> <span class="pl-smi rich-diff-level-one">com.dangdang.example.elasticjob.core.job.PerpetualElasticDemoJob</span>;
<span class="pl-k rich-diff-level-one">import</span> <span class="pl-smi rich-diff-level-one">com.dangdang.example.elasticjob.core.job.SequencePerpetualElasticDemoJob</span>;

<span class="pl-k rich-diff-level-one">public</span> <span class="pl-k rich-diff-level-one">class</span> <span class="pl-en rich-diff-level-one">JobDemo</span> {

    <span class="pl-c rich-diff-level-one">// 定义Zookeeper注册中心配置对象</span>
    <span class="pl-k rich-diff-level-one">private</span> <span class="pl-smi rich-diff-level-one">ZookeeperConfiguration</span> zkConfig <span class="pl-k rich-diff-level-one">=</span> <span class="pl-k rich-diff-level-one">new</span> <span class="pl-smi rich-diff-level-one">ZookeeperConfiguration</span>(<span class="pl-s rich-diff-level-one"><span class="pl-pds">"</span>localhost:2181<span class="pl-pds">"</span></span>, <span class="pl-s rich-diff-level-one"><span class="pl-pds">"</span>elastic-job-example<span class="pl-pds">"</span></span>, <span class="pl-c1 rich-diff-level-one">1000</span>, <span class="pl-c1 rich-diff-level-one">3000</span>, <span class="pl-c1 rich-diff-level-one">3</span>);

    <span class="pl-c rich-diff-level-one">// 定义Zookeeper注册中心</span>
    <span class="pl-k rich-diff-level-one">private</span> <span class="pl-smi rich-diff-level-one">CoordinatorRegistryCenter</span> regCenter <span class="pl-k rich-diff-level-one">=</span> <span class="pl-k rich-diff-level-one">new</span> <span class="pl-smi rich-diff-level-one">ZookeeperRegistryCenter</span>(zkConfig);

    <span class="pl-c rich-diff-level-one">// 定义作业1配置对象</span>
    <span class="pl-k rich-diff-level-one">private</span> <span class="pl-smi rich-diff-level-one">JobConfiguration</span> jobConfig1 <span class="pl-k rich-diff-level-one">=</span> <span class="pl-k rich-diff-level-one">new</span> <span class="pl-smi rich-diff-level-one">JobConfiguration</span>(<span class="pl-s rich-diff-level-one"><span class="pl-pds">"</span>oneOffElasticDemoJob<span class="pl-pds">"</span></span>, <span class="pl-smi rich-diff-level-one">OneOffElasticDemoJob</span><span class="pl-k rich-diff-level-one">.</span>class, <span class="pl-c1 rich-diff-level-one">10</span>, <span class="pl-s rich-diff-level-one"><span class="pl-pds">"</span>0/5 * * * * ?<span class="pl-pds">"</span></span>);

    <span class="pl-c rich-diff-level-one">// 定义作业2配置对象</span>
    <span class="pl-k rich-diff-level-one">private</span> <span class="pl-smi rich-diff-level-one">JobConfiguration</span> jobConfig2 <span class="pl-k rich-diff-level-one">=</span> <span class="pl-k rich-diff-level-one">new</span> <span class="pl-smi rich-diff-level-one">JobConfiguration</span>(<span class="pl-s rich-diff-level-one"><span class="pl-pds">"</span>perpetualElasticDemoJob<span class="pl-pds">"</span></span>, <span class="pl-smi rich-diff-level-one">PerpetualElasticDemoJob</span><span class="pl-k rich-diff-level-one">.</span>class, <span class="pl-c1 rich-diff-level-one">10</span>, <span class="pl-s rich-diff-level-one"><span class="pl-pds">"</span>0/5 * * * * ?<span class="pl-pds">"</span></span>);

    <span class="pl-c rich-diff-level-one">// 定义作业3配置对象</span>
    <span class="pl-k rich-diff-level-one">private</span> <span class="pl-smi rich-diff-level-one">JobConfiguration</span> jobConfig3 <span class="pl-k rich-diff-level-one">=</span> <span class="pl-k rich-diff-level-one">new</span> <span class="pl-smi rich-diff-level-one">JobConfiguration</span>(<span class="pl-s rich-diff-level-one"><span class="pl-pds">"</span>sequencePerpetualElasticDemoJob<span class="pl-pds">"</span></span>, <span class="pl-smi rich-diff-level-one">SequencePerpetualElasticDemoJob</span><span class="pl-k rich-diff-level-one">.</span>class, <span class="pl-c1 rich-diff-level-one">10</span>, <span class="pl-s rich-diff-level-one"><span class="pl-pds">"</span>0/5 * * * * ?<span class="pl-pds">"</span></span>);

    <span class="pl-k rich-diff-level-one">public</span> <span class="pl-k rich-diff-level-one">static</span> <span class="pl-k rich-diff-level-one">void</span> <span class="pl-en rich-diff-level-one">main</span>(<span class="pl-k rich-diff-level-one">final</span> <span class="pl-k rich-diff-level-one">String</span>[] <span class="pl-v rich-diff-level-one">args</span>) {
        <span class="pl-k rich-diff-level-one">new</span> <span class="pl-smi rich-diff-level-one">JobDemo</span>()<span class="pl-k rich-diff-level-one">.</span>init();
    }

    <span class="pl-k rich-diff-level-one">private</span> <span class="pl-k rich-diff-level-one">void</span> <span class="pl-en rich-diff-level-one">init</span>() {
        <span class="pl-c rich-diff-level-one">// 连接注册中心</span>
        regCenter<span class="pl-k rich-diff-level-one">.</span>init();
        <span class="pl-c rich-diff-level-one">// 启动作业1</span>
        <span class="pl-k rich-diff-level-one">new</span> <span class="pl-smi rich-diff-level-one">JobController</span>(regCenter, jobConfig1)<span class="pl-k rich-diff-level-one">.</span>init();
        <span class="pl-c rich-diff-level-one">// 启动作业2</span>
        <span class="pl-k rich-diff-level-one">new</span> <span class="pl-smi rich-diff-level-one">JobController</span>(regCenter, jobConfig2)<span class="pl-k rich-diff-level-one">.</span>init();
        <span class="pl-c rich-diff-level-one">// 启动作业3</span>
        <span class="pl-k rich-diff-level-one">new</span> <span class="pl-smi rich-diff-level-one">JobController</span>(regCenter, jobConfig3)<span class="pl-k rich-diff-level-one">.</span>init();
    }
}</pre></div>
      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/dangdangdotcom/elastic-job">Elastic-job</a> is maintained by <a href="https://github.com/dangdangdotcom">dangdangdotcom</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("elastic-job");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
