<assembly xmlns="http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.2"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/plugins/maven-assembly-plugin/assembly/1.1.2 
                        http://maven.apache.org/xsd/assembly-1.1.2.xsd" >
    <id>assembly</id>
    <formats>
        <format>tar.gz</format>
    </formats>
    <includeBaseDirectory>true</includeBaseDirectory>
    <fileSets>
        <fileSet>
            <directory>classpath:assemblies/bin/properties/jmx_config</directory>
            <outputDirectory>bin/properties/jmx_config</outputDirectory>
            <includes>
                <include>jmxremote.password</include>
            </includes>
            <fileMode>0600</fileMode>
        </fileSet>
        <fileSet>
            <directory>classpath:assemblies/bin</directory>
            <outputDirectory>bin</outputDirectory>
            <fileMode>0755</fileMode>
        </fileSet>
        <fileSet>
            <directory>classpath:assemblies/app</directory>
            <outputDirectory>app</outputDirectory>
            <fileMode>0644</fileMode>
        </fileSet>
        <fileSet>
            <directory>classpath:assemblies/conf</directory>
            <outputDirectory>conf</outputDirectory>
            <fileMode>0644</fileMode>
        </fileSet>
        <fileSet>
            <directory>src/main/resources/conf</directory>
            <includes>
                <include>*.properties</include>
                <include>*/*.properties</include>
                <include>logback.xml</include>
            </includes>
            <excludes>
                <exclude>*.private.properties</exclude>
                <exclude>*/*.private.properties</exclude>
            </excludes>
            <outputDirectory>conf</outputDirectory>
            <fileMode>0644</fileMode>
        </fileSet>
    </fileSets>
    
    <dependencySets>
        <!-- copy all dd-frame and third party jars to lib folder. -->
        <dependencySet>
            <outputDirectory>lib</outputDirectory>
            <excludes>
                <exclude>com.dangdang:*</exclude>
                <exclude>com.dang:*</exclude>
            </excludes>
        </dependencySet>
        <dependencySet>
            <outputDirectory>lib</outputDirectory>
            <includes>
                <include>com.dangdang:apimonitor</include>
                <include>com.dangdang:ddschedule</include>
                <include>com.dangdang:dd-assembly-plugin</include>
                <include>com.dangdang:dd-common</include>
                <include>com.dangdang:dd-container</include>
                <include>com.dangdang:dd-soa</include>
                <include>com.dangdang:dd-job</include>
                <include>com.dangdang:dd-job-tbschedule</include>
                <include>com.dangdang:dd-rdb</include>
                <include>com.dangdang:dd-reg</include>
                <include>com.dangdang:dd-log</include>
                <include>com.dangdang:dd-web</include>
                <include>com.dangdang:dd-test</include>
                <include>com.dangdang:dd-package</include>
                <include>com.dangdang:elastic-job-core</include>
                <include>com.dangdang:elastic-job-spring</include>
            </includes>
            <fileMode>0644</fileMode>
        </dependencySet>
        
        <!-- copy all dangdang jars to app folder. -->
        <dependencySet>
            <outputDirectory>app</outputDirectory>
            <includes>
                <include>com.dangdang:*</include>
                <include>com.dang:*</include>
            </includes>
            <excludes>
                <exclude>com.dangdang:apimonitor</exclude>
                <exclude>com.dangdang:ddschedule</exclude>
                <exclude>com.dangdang:dd-assembly-plugin</exclude>
                <exclude>com.dangdang:dd-common</exclude>
                <exclude>com.dangdang:dd-container</exclude>
                <exclude>com.dangdang:dd-soa</exclude>
                <exclude>com.dangdang:dd-job</exclude>
                <exclude>com.dangdang:dd-job-tbschedule</exclude>
                <exclude>com.dangdang:dd-rdb</exclude>
                <exclude>com.dangdang:dd-reg</exclude>
                <exclude>com.dangdang:dd-log</exclude>
                <exclude>com.dangdang:dd-web</exclude>
                <exclude>com.dangdang:dd-test</exclude>
                <exclude>com.dangdang:dd-package</exclude>
                <exclude>com.dangdang:elastic-job-core</exclude>
                <exclude>com.dangdang:elastic-job-spring</exclude>
            </excludes>
            <fileMode>0644</fileMode>
        </dependencySet>
        
        <!-- 
            Copy all dangdang jar's '*.properties' and profiles's '*.properties' to conf folder, exclude '*.private.properties'.
        -->
        <dependencySet>
            <includes>
                 <include>com.dang*:*</include>
            </includes>
            <excludes>
                <exclude>com.dangdang:apimonitor</exclude>
                <exclude>com.dangdang:ddschedule</exclude>
                <exclude>com.dangdang:dd-assembly-plugin</exclude>
                <exclude>com.dangdang:dd-common</exclude>
                <exclude>com.dangdang:dd-container</exclude>
                <exclude>com.dangdang:dd-soa</exclude>
                <exclude>com.dangdang:dd-job</exclude>
                <exclude>com.dangdang:dd-job-tbschedule</exclude>
                <exclude>com.dangdang:dd-rdb</exclude>
                <exclude>com.dangdang:dd-reg</exclude>
                <exclude>com.dangdang:dd-log</exclude>
                <exclude>com.dangdang:dd-web</exclude>
                <exclude>com.dangdang:dd-test</exclude>
                <exclude>com.dangdang:dd-package</exclude>
                <exclude>com.dangdang:elastic-job-core</exclude>
                <exclude>com.dangdang:elastic-job-spring</exclude>
            </excludes>
            <unpack>true</unpack>
            <unpackOptions>
                <includes>
                    <include>conf/*.properties</include>
                    <include>conf/*/*.properties</include>
                    <include>conf/logback.xml</include>
                    <include>conf/includedLogbackConfig.xml</include>
                </includes>
                <excludes>
                    <exclude>conf/*.private.properties</exclude>
                    <exclude>conf/*/*.private.properties</exclude>
                </excludes>
            </unpackOptions>
            <fileMode>0644</fileMode>
        </dependencySet>
        <!-- 
            If app jar does not have includedLogbackConfig.xml, copy default includedLogbackConfig.xml to conf folder. For ddframe package only.
        -->
        <dependencySet>
            <includes>
                <include>com.dangdang:dd-log</include>
            </includes>
            <unpack>true</unpack>
            <unpackOptions>
                <includes>
                    <include>includedLogbackConfig.xml</include>
                </includes>
            </unpackOptions>
            <fileMode>0644</fileMode>
            <outputDirectory>conf/</outputDirectory>
        </dependencySet>
    </dependencySets>
</assembly>
