<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Elastic-job by dangdangdotcom</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Elastic-job</h1>
      <h2 class="project-tagline">Elastic-Job is a distributed scheduled job framework, based on Quartz and Curator.</h2>
      <a href="https://github.com/dangdangdotcom/elastic-job" class="btn">View on GitHub</a>
      <a href="https://github.com/dangdangdotcom/elastic-job/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/dangdangdotcom/elastic-job/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h2>
<a id="elastic-job---distributed-scheduled-job-solution" class="anchor" href="#elastic-job---distributed-scheduled-job-solution" aria-hidden="true"><span class="octicon octicon-link"></span></a>Elastic-Job - distributed scheduled job solution</h2>

<p><a href="http://www.apache.org/licenses/LICENSE-2.0.html"><img src="http://dangdangdotcom.github.io/elastic-job/images/license.svg" alt="Hex.pm"></a></p>

<p>Elastic-Job是ddframe中dd-job的作业模块中分离出来的分布式弹性作业框架。去掉了和dd-job中的监控和ddframe接入规范部分。该项目基于成熟的开源产品Quartz和Zookeeper及其客户端Curator进行二次开发。</p>

<p>ddframe其他模块也有可独立开源的部分，之前当当曾开源过dd-soa的基石模块DubboX。</p>

<p>elastic-job和ddframe关系见下图</p>

<p><img src="http://dangdangdotcom.github.io/elastic-job/images/ddframe.jpg" alt="ddframe演进图"></p>

<h2>
<a id="主要贡献者" class="anchor" href="#%E4%B8%BB%E8%A6%81%E8%B4%A1%E7%8C%AE%E8%80%85" aria-hidden="true"><span class="octicon octicon-link"></span></a>主要贡献者</h2>

<ul>
<li>张亮 <a href="http://www.dangdang.com/">当当网</a> <a href="mailto:zhangliang@dangdang.com">zhangliang@dangdang.com</a>
</li>
<li>曹昊 <a href="http://www.dangdang.com/">当当网</a> <a href="mailto:caohao@dangdang.com">caohao@dangdang.com</a>
</li>
<li>江树建 <a href="http://www.dangdang.com/">当当网</a> <a href="mailto:jiangshujian@dangdang.com">jiangshujian@dangdang.com</a>
</li>
</ul>

<p><strong>讨论QQ群：</strong>430066234（不限于Elastic-Job，包括分布式，定时任务相关以及其他互联网技术交流）</p>

<h2>
<a id="elastic-job主要功能" class="anchor" href="#elastic-job%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD" aria-hidden="true"><span class="octicon octicon-link"></span></a>Elastic-Job主要功能</h2>

<ul>
<li>
<strong>定时任务：</strong> 基于成熟的定时任务作业框架Quartz CRON表达式执行定时任务。</li>
<li>
<strong>作业注册中心：</strong> 基于Zookeeper及其客户端Curator实现的全局注册中心。用于注册，控制和协调分布式作业执行。</li>
<li>
<strong>作业分片：</strong> 将单一任务分片为多个小任务项并在多服务器并行执行。</li>
<li>
<strong>弹性扩容缩容：</strong> 运行中的作业服务器崩溃或新增，作业框架将在下次作业执行前重分片，不影响当前作业执行。</li>
<li>
<strong>支持多种作业执行模式：</strong> 支持Simple，ThroughputDataFlow和SequenceDataFlow三种作业模式。</li>
<li>
<strong>失效转移：</strong> 运行中的作业服务器崩溃不会导致重分片，只会在下次作业启动时分片。启用失效转移功能可以在本次作业执行过程中，监测其他作业服务器空闲，抓取未完成的孤儿分片项执行。</li>
<li>
<strong>运行时状态收集：</strong> 监控作业运行时状态，统计最近一段时间处理的数据成功和失败数量，记录作业上次运行开始时间，结束时间和下次运行时间。</li>
<li>
<strong>作业停止，恢复和禁用：</strong>用于作业启停，并可禁止某作业运行（上线时常用）。</li>
<li>
<strong>被错过执行的作业重触发：</strong>自动记录错过执行的作业，并在上次作业完成后自动触发。可参考Quartz的misfire。</li>
<li>
<strong>多线程快速处理数据：</strong>使用多线程处理抓取到的数据，提升吞吐量。</li>
<li>
<strong>幂等性：</strong>重复作业任务项判定，不重复执行已运行的作业任务项。由于开启幂等性需要监听作业运行状态，对瞬时反复运行的作业对性能有较大影响。</li>
<li>
<strong>容错处理：</strong>作业服务器与作业注册中心通信失败则立即停止作业运行，防止作业注册中心将失效的分片项分配给其他作业服务器，而当前作业服务器仍在执行任务，导致重复执行。</li>
<li>
<strong>数据处理偏移量存储：</strong>可将上次处理数据的位置储入Zookeeper。</li>
<li>
<strong>Spring支持：</strong>支持spring容器，自定义命名空间，占位符等。</li>
<li>
<strong>运维平台：</strong>提供运维界面，用于管理作业和注册中心。</li>
</ul>

<h2>
<a id="相关文档" class="anchor" href="#%E7%9B%B8%E5%85%B3%E6%96%87%E6%A1%A3" aria-hidden="true"><span class="octicon octicon-link"></span></a>相关文档</h2>

<p><a href="http://dangdangdotcom.github.io/elastic-job/downloads.html">下载</a></p>

<p><a href="http://dangdangdotcom.github.io/elastic-job/releaseNotes.html">Release Notes</a></p>

<p><a href="http://dangdangdotcom.github.io/elastic-job/1.0.2UpdateNotes.html">1.0.2接口变更声明</a></p>

<p><a href="http://dangdangdotcom.github.io/elastic-job/distribution.html">何为分布式作业？</a></p>

<p><a href="http://dangdangdotcom.github.io/elastic-job/directoryStructure.html">目录结构说明</a></p>

<p><a href="http://dangdangdotcom.github.io/elastic-job/usage.html">使用步骤</a></p>

<p><a href="http://dangdangdotcom.github.io/elastic-job/userGuide.html">开发指南</a></p>

<p><a href="http://dangdangdotcom.github.io/elastic-job/limitations.html">使用限制</a></p>

<p><a href="http://dangdangdotcom.github.io/elastic-job/webConsole.html">运维平台</a></p>

<p><a href="http://dangdangdotcom.github.io/elastic-job/sourceCodeGuide.html">阅读源码编译问题说明</a></p>

<p><a href="http://dangdangdotcom.github.io/elastic-job/theory.html">实现原理</a></p>

<p><a href="http://dangdangdotcom.github.io/elastic-job/jobStrategy.html">作业分片策略</a></p>

<p><a href="http://dangdangdotcom.github.io/elastic-job/execution.html">作业运行状态监听</a></p>

<p><a href="http://dangdangdotcom.github.io/elastic-job/dump.html">dump作业运行信息（便于开发者debug）</a></p>

<p><a href="http://dangdangdotcom.github.io/elastic-job/quickStart.html">快速上手</a>（感谢第三方志愿者 泽伟@心探索科技 提供文档）</p>

<p><a href="http://www.infoq.com/cn/news/2015/09/dangdang-elastic-job">InfoQ新闻</a></p>

<p><a href="https://github.com/dangdangdotcom/elastic-job/wiki">Elastic-Job Wiki</a> （由社区志愿者自由编辑的）</p>

<h2>
<a id="quick-start" class="anchor" href="#quick-start" aria-hidden="true"><span class="octicon octicon-link"></span></a>Quick Start</h2>

<ul>
<li><strong>引入maven依赖</strong></li>
</ul>

<p>elastic-job已经发布到中央仓库，可以在pom.xml文件中直接引入maven坐标。</p>

<div class="highlight highlight-text-xml"><pre><span class="pl-c">&lt;!-- 引入elastic-job核心模块 --&gt;</span>
&lt;<span class="pl-ent">dependency</span>&gt;
    &lt;<span class="pl-ent">groupId</span>&gt;com.dangdang&lt;/<span class="pl-ent">groupId</span>&gt;
    &lt;<span class="pl-ent">artifactId</span>&gt;elastic-job-core&lt;/<span class="pl-ent">artifactId</span>&gt;
    &lt;<span class="pl-ent">version</span>&gt;1.0.2&lt;/<span class="pl-ent">version</span>&gt;
&lt;/<span class="pl-ent">dependency</span>&gt;

<span class="pl-c">&lt;!-- 使用springframework自定义命名空间时引入 --&gt;</span>
&lt;<span class="pl-ent">dependency</span>&gt;
    &lt;<span class="pl-ent">groupId</span>&gt;com.dangdang&lt;/<span class="pl-ent">groupId</span>&gt;
    &lt;<span class="pl-ent">artifactId</span>&gt;elastic-job-spring&lt;/<span class="pl-ent">artifactId</span>&gt;
    &lt;<span class="pl-ent">version</span>&gt;1.0.2&lt;/<span class="pl-ent">version</span>&gt;
&lt;/<span class="pl-ent">dependency</span>&gt;</pre></div>

<ul>
<li><strong>作业开发</strong></li>
</ul>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MyElasticJob</span> <span class="pl-k">extends</span> <span class="pl-e">AbstractThroughputDataFlowElasticJob&lt;<span class="pl-smi">Foo</span>&gt;</span> {

    <span class="pl-k">@Override</span>
    <span class="pl-k">protected</span> <span class="pl-k">List&lt;<span class="pl-smi">Foo</span>&gt;</span> <span class="pl-en">fetchData</span>(<span class="pl-smi">JobExecutionMultipleShardingContext</span> <span class="pl-v">context</span>) {
        <span class="pl-k">Map&lt;<span class="pl-smi">Integer</span>, <span class="pl-smi">String</span>&gt;</span> offset <span class="pl-k">=</span> context<span class="pl-k">.</span>getOffsets();
        <span class="pl-k">List&lt;<span class="pl-smi">Foo</span>&gt;</span> result <span class="pl-k">=</span> <span class="pl-c">// get data from database by sharding items and by offset</span>
        <span class="pl-k">return</span> result;
    }

    <span class="pl-k">@Override</span>
    <span class="pl-k">protected</span> <span class="pl-k">boolean</span> <span class="pl-en">processData</span>(<span class="pl-smi">JobExecutionMultipleShardingContext</span> <span class="pl-v">context</span>, <span class="pl-smi">Foo</span> <span class="pl-v">data</span>) {
        <span class="pl-c">// process data</span>
        <span class="pl-c">// ...</span>

        <span class="pl-c">// store offset</span>
        <span class="pl-k">for</span> (<span class="pl-k">int</span> each <span class="pl-k">:</span> context<span class="pl-k">.</span>getShardingItems()) {
            updateOffset(each, <span class="pl-s"><span class="pl-pds">"</span>your offset, maybe id<span class="pl-pds">"</span></span>);
        }
        <span class="pl-k">return</span> <span class="pl-c1">true</span>;
    }
}</pre></div>

<ul>
<li><strong>作业配置</strong></li>
</ul>

<div class="highlight highlight-text-xml"><pre>&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span><span class="pl-e"> encoding</span>=<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>?&gt;
&lt;<span class="pl-ent">beans</span> <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.springframework.org/schema/beans<span class="pl-pds">"</span></span>
    <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">xsi</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="pl-pds">"</span></span>
    <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">reg</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.dangdang.com/schema/ddframe/reg<span class="pl-pds">"</span></span>
    <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">job</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.dangdang.com/schema/ddframe/job<span class="pl-pds">"</span></span>
    <span class="pl-e">xsi</span><span class="pl-e">:</span><span class="pl-e">schemaLocation</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.springframework.org/schema/beans </span>
<span class="pl-s">                        http://www.springframework.org/schema/beans/spring-beans.xsd </span>
<span class="pl-s">                        http://www.dangdang.com/schema/ddframe/reg </span>
<span class="pl-s">                        http://www.dangdang.com/schema/ddframe/reg/reg.xsd </span>
<span class="pl-s">                        http://www.dangdang.com/schema/ddframe/job </span>
<span class="pl-s">                        http://www.dangdang.com/schema/ddframe/job/job.xsd </span>
<span class="pl-s">                        <span class="pl-pds">"</span></span>&gt;
    <span class="pl-c">&lt;!--配置作业注册中心 --&gt;</span>
    &lt;<span class="pl-ent">reg</span><span class="pl-ent">:</span><span class="pl-ent">zookeeper</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>regCenter<span class="pl-pds">"</span></span> <span class="pl-e">serverLists</span>=<span class="pl-s"><span class="pl-pds">"</span> yourhost:2181<span class="pl-pds">"</span></span> <span class="pl-e">namespace</span>=<span class="pl-s"><span class="pl-pds">"</span>dd-job<span class="pl-pds">"</span></span> <span class="pl-e">baseSleepTimeMilliseconds</span>=<span class="pl-s"><span class="pl-pds">"</span>1000<span class="pl-pds">"</span></span> <span class="pl-e">maxSleepTimeMilliseconds</span>=<span class="pl-s"><span class="pl-pds">"</span>3000<span class="pl-pds">"</span></span> <span class="pl-e">maxRetries</span>=<span class="pl-s"><span class="pl-pds">"</span>3<span class="pl-pds">"</span></span> /&gt;

    <span class="pl-c">&lt;!-- 配置作业--&gt;</span>
    &lt;<span class="pl-ent">job</span><span class="pl-ent">:</span><span class="pl-ent">bean</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>oneOffElasticJob<span class="pl-pds">"</span></span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>xxx.MyElasticJob<span class="pl-pds">"</span></span> <span class="pl-e">regCenter</span>=<span class="pl-s"><span class="pl-pds">"</span>regCenter<span class="pl-pds">"</span></span> <span class="pl-e">cron</span>=<span class="pl-s"><span class="pl-pds">"</span>0/10 * * * * ?<span class="pl-pds">"</span></span>   <span class="pl-e">shardingTotalCount</span>=<span class="pl-s"><span class="pl-pds">"</span>3<span class="pl-pds">"</span></span> <span class="pl-e">shardingItemParameters</span>=<span class="pl-s"><span class="pl-pds">"</span>0=A,1=B,2=C<span class="pl-pds">"</span></span> /&gt;
&lt;/<span class="pl-ent">beans</span>&gt;</pre></div>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/dangdangdotcom/elastic-job">Elastic-job</a> is maintained by <a href="https://github.com/dangdangdotcom">dangdangdotcom</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("elastic-job");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
