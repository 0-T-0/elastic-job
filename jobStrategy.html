<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Elastic-job by dangdangdotcom</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Elastic-job</h1>
      <h2 class="project-tagline">Elastic-Job is a distributed scheduled job framework, based on Quartz and Curator.</h2>
      <a href="https://github.com/dangdangdotcom/elastic-job" class="btn">View on GitHub</a>
      <a href="https://github.com/dangdangdotcom/elastic-job/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/dangdangdotcom/elastic-job/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
<h2>
<a class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>作业分片策略</h2>

<ul>
<li>
<p><strong>框架提供的分片策略</strong></p>

<ol>
<li>
	<p><strong>AverageAllocationJobShardingStrategy</strong></p>
	<p><strong>全路径：</strong></p>
	<p>com.dangdang.ddframe.job.plugin.sharding.strategy.AverageAllocationJobShardingStrategy</p>
	<p><strong>策略说明：</strong></p>
	<p>基于平均分配算法的分片策略，也是默认的分片策略。</p>
	<p>如果分片不能整除，则不能整除的多余分片将依次追加到序号小的服务器。</p>
	<p>如：</p>
	<p>如果有3台服务器，分成9片，则每台服务器分到的分片是：1=[0,1,2], 2=[3,4,5], 3=[6,7,8]</p>
	<p>如果有3台服务器，分成8片，则每台服务器分到的分片是：1=[0,1,6], 2=[2,3,7], 3=[4,5]</p>
	<p>如果有3台服务器，分成10片，则每台服务器分到的分片是：1=[0,1,2,9], 2=[3,4,5], 3=[6,7,8]</p>
</li>
<li>
	<p><strong>OdevitySortByNameJobShardingStrategy</strong></p>
	<p><strong>全路径：</strong></p>
	<p>com.dangdang.ddframe.job.plugin.sharding.strategy.OdevitySortByNameJobShardingStrategy</p>
	<p><strong>策略说明：</strong></p>
	<p>根据作业名的哈希值奇偶数决定IP升降序算法的分片策略。</p>
	<p>作业名的哈希值为奇数则IP升序。</p>
	<p>作业名的哈希值为偶数则IP降序。</p>
	<p>用于不同的作业平均分配负载至不同的服务器。</p>
	<p>AverageAllocationJobShardingStrategy的缺点是，一旦分片数小于作业服务器数，作业将永远分配至IP地址靠前的服务器，导致IP地址靠后的服务器空闲。而OdevitySortByNameJobShardingStrategy则可以根据作业名称重新分配服务器负载。</p>
	<p>如：</p>
	<p>如果有3台服务器，分成2片，作业名称的哈希值为奇数，则每台服务器分到的分片是：1=[0], 2=[1], 3=[]</p>
	<p>如果有3台服务器，分成2片，作业名称的哈希值为偶数，则每台服务器分到的分片是：3=[0], 2=[1], 1=[]</p>
</li>
<li>
	<p><strong>RotateServerByNameJobShardingStrategy</strong></p>
	<p><strong>全路径：</strong></p>
	<p>com.dangdang.ddframe.job.plugin.sharding.strategy.RotateServerByNameJobShardingStrategy</p>
	<p><strong>策略说明：</strong></p>
	<p>根据作业名的哈希值对服务器列表进行轮转的分片策略。</p>
</li>
</ol>
</li>
<li>
<p><strong>自定义分片策略</strong></p>

<p>实现JobShardingStrategy接口并实现sharding方法，接口方法参数为作业服务器IP列表和分片策略选项，分片策略选项包括作业名称，分片总数以及分片序列号和个性化参数对照表，可以根据需求定制化自己的分片策略。</p>
<p>欢迎将分片策略以插件的形式贡献至com.dangdang.ddframe.job.plugin.sharding.strategy包。</p>
</li>
<li>
<p><strong>配置分片策略</strong></p>

<p>与配置通常的作业属性相同，在spring命名空间或者JobConfiguration中配置jobShardingStrategyClass属性，属性值是作业分片策略类的全路径。</p>
</li>
      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/dangdangdotcom/elastic-job">Elastic-job</a> is maintained by <a href="https://github.com/dangdangdotcom">dangdangdotcom</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("elastic-job");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
